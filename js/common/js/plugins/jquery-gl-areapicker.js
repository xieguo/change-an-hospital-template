/*! common - git - 2018-12-27 15:52:32 */
!function(e){function n(n,a){this.container=n,this.options={plinkCallback:null,clinkCallback:null,dataUrl:null,selArea:null,hideProvince:null,provinceTpl:"<li><a href='javascript:void(0);' name='province' class='J_ProvinceLink' data-val='{{areaId}}' data-nosub='{{nosub}}' title='{{areaName}}'>{{areaName}}</a></li>",cityTpl:"<li><a href='javascript:void(0);' name='city' class='J_CityLink' data-val='{{areaId}}' parent-id='{{parentAreaId}}' parent-name='{{parentAreaName}}' title='{{areaName}}'>{{areaName}}</a></li>"},this.areaInfo={},e.extend(this.options,a),this._init()}e.extend(n.prototype,{_init:function(){var e=this;e._getData(),e._bindEvent()},_getData:function(){var n=this,a=$GC.guahaoServer+"/json/white/area/provinces";e.getJSON(a,function(e){e&&e.length>0&&(n.areaInfo=e,n.options.hideProvince&&n.options.selArea.provinceId?(n.rendCity(n.options.selArea.provinceId,n.options.selArea.provinceName),n.container.find(".J_HotCity").hide(),n.container.find(".J_ProvinceContainer").hide(),n.container.find(".J_CityContainer .content-title").hide(),n.options.selArea.cityId&&n.container.find(".J_CityLink[data-val='"+n.options.selArea.cityId+"']").addClass("on"),n.container.find(".J_CityContainer").show()):n.rendProvince())})},_formatData:function(n){for(var a=this,i=0;i<n.length;i++){var t=n[i];if(1==t.areaType){var r="p"+t.areaId;a.areaInfo[r]?e.extend(a.areaInfo[r],t):a.areaInfo[r]=t}else if(2==t.areaType){var o="c"+t.areaId,r="p"+t.parentAreaId;a.areaInfo[r]?a.areaInfo[r][o]=t:(a.areaInfo[r]={},a.areaInfo[r][o]=t)}}},_getProvince:function(e){for(var n=this,a=n.areaInfo.length,i=0;i<a;i++)if(n.areaInfo[i].areaId==e)return n.areaInfo[i];return null},rendProvince:function(){var n=this;if(n.options.provinceTpl){var a=[];n.options.homeFlag||a.push("<li><a href='javascript:void(0);' name='province' class='J_ProvinceLink' data-val='all' data-nosub='1'>全国</a></li>"),e.each(n.areaInfo,function(){var e=this,i=n.options.hideAreas;if(i){for(var t=!1,r=0;r<i.length;r++)if(i[r]==e.areaId){t=!0;break}if(t)return!1}e.nosub=1,e.cities&&e.cities.length>0&&(e.nosub=0),a.push(n._pRender(n.options.provinceTpl,e))}),n.container.find(".J_ProvinceUl").html(a.join(""))}},_pRender:function(e,n){return e=e.replace(/{{areaId}}/g,n.value),e=e.replace(/{{areaName}}/g,n.text),e=e.replace(/{{nosub}}/g,"0")},_cRender:function(e,n){return e=e.replace(/{{areaId}}/g,n.value),e=e.replace(/{{parentAreaId}}/g,n.parentAreaId),e=e.replace(/{{parentAreaName}}/g,n.parentAreaName),e=e.replace(/{{areaName}}/g,n.text)},rendCity:function(n,a){var i=this,t=$GC.guahaoServer+"/json/white/area/citys?provinceId="+n;e.getJSON(t,function(t){if(t&&t.length>0){var r=[];e.each(t,function(){var e=this;e.parentAreaName=a,e.parentAreaId=n,r.push(i._cRender(i.options.cityTpl,e))}),i.container.find(".J_CityWrap").append("<ul class='J_City"+n+"'>"+r.join("")+"</ul>")}})},_bindEvent:function(){var n=this;n.container.find(".close").click(function(e){GreenLine.Util.isIE6()||GreenLine.Util.isIE7()?n.container.parents(".J_AreaFilter").css("z-index",0):n.container.css("z-index",0),n.container.hide()}),n.container.delegate(".J_ProvinceLink","click",function(a){a.preventDefault();var i=e(a.target),t=i.attr("data-val"),r=i.text(),o=i.attr("data-nosub");t&&0==o&&(n.container.find(".J_CityWrap ul").hide(),n.container.find(".J_SelProvince").text(r),n.container.find("J_City"+t).length>0?n.container.find("J_City"+t).show():n.rendCity(t,r)),n.options.plinkCallback&&n.options.plinkCallback.call(n,e(this))}),n.container.delegate(".J_CityLink","click",function(a){a.preventDefault(),n.options.clinkCallback&&n.options.clinkCallback.call(n,e(this)),GreenLine.Util.isIE6()||GreenLine.Util.isIE7()?n.container.parents(".J_AreaFilter").css("z-index",0):n.container.css("z-index",0),n.container.hide()}),n.container.delegate(".J_AreaBack","click",function(e){e.preventDefault(),n.container.find(".J_ProvinceContainer").show(),n.container.find(".J_CityContainer").hide()}),e(document).mousedown(function(a){!e(a.target).hasClass("J_Area")&&!e(a.target).parents(".J_Area").length>0&&(GreenLine.Util.isIE6()||GreenLine.Util.isIE7()?n.container.parents(".J_AreaFilter").css("z-index",0):n.container.css("z-index",0),n.container.hide())})}}),e.fn.glAreapicker=function(a){return this.data("areapicker")?this:this.each(function(){var i=e(this),t=new n(i,a);i.data("areapicker",t)})}}(jQuery);